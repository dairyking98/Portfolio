{% extends "base.html" %}

{% block title %}Typewriters - {{ SITENAME }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/css/typewriters.css" />
{% endblock %}

{% block content %}
<article class="page typewriters-page">
    <h1>{{ page.title }}</h1>
    
    <div class="typewriters-intro">
        {{ page.content }}
    </div>
    
    {% set all_articles = articles %}
    
    <!-- General Typewriter Blog Posts -->
    <section class="typewriter-section" id="typewriter-blog-posts">
        <h2>Typewriter Blog Posts</h2>
        <p>General posts about typewriters, including collection updates, restoration work, and related topics.</p>
        
        {% set has_typewriter_posts = false %}
        {% for article in all_articles %}
            {% if article.category and article.category.name == "Typewriters" %}
                {% set has_typewriter_posts = true %}
            {% endif %}
        {% endfor %}
        
        {% if has_typewriter_posts %}
        <!-- Posts categorized by My Collection -->
        {% set has_collection_blog_posts = false %}
        {% for article in all_articles %}
            {% if article.category and article.category.name == "Typewriters" %}
                {% if article.tags %}
                    {% for tag in article.tags %}
                        {% if tag.name == "my-collection" %}
                            {% set has_collection_blog_posts = true %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endif %}
        {% endfor %}
        
        {% if has_collection_blog_posts %}
        <div class="posts-subsection">
            <h3>Collection-Related Posts</h3>
            <div class="posts-list">
                {% for article in all_articles %}
                    {% if article.category and article.category.name == "Typewriters" %}
                        {% if article.tags %}
                            {% set is_collection = false %}
                            {% for tag in article.tags %}
                                {% if tag.name == "my-collection" %}
                                    {% set is_collection = true %}
                                {% endif %}
                            {% endfor %}
                            {% if is_collection %}
                            <article class="post-preview">
                                <h4><a href="{{ SITEURL }}/{{ article.url }}">{{ article.title }}</a></h4>
                                <div class="post-meta">
                                    <time datetime="{{ article.date.isoformat() }}">{{ article.locale_date }}</time>
                                    {% if article.tags %}
                                    <span class="tags">
                                        {% for tag in article.tags %}
                                        <a href="{{ SITEURL }}/{{ tag.url }}" class="tag">{{ tag.name }}</a>
                                        {% endfor %}
                                    </span>
                                    {% endif %}
                                </div>
                                {% if article.summary %}
                                <p class="post-summary">{{ article.summary }}</p>
                                {% endif %}
                                <a href="{{ SITEURL }}/{{ article.url }}" class="read-more">Read more →</a>
                            </article>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Posts categorized by 3D Type Elements -->
        {% set has_3d_blog_posts = false %}
        {% for article in all_articles %}
            {% if article.category and article.category.name == "Typewriters" %}
                {% if article.tags %}
                    {% for tag in article.tags %}
                        {% if tag.name == "3d-type-elements" %}
                            {% set has_3d_blog_posts = true %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endif %}
        {% endfor %}
        
        {% if has_3d_blog_posts %}
        <div class="posts-subsection">
            <h3>3D Type Elements Posts</h3>
            <div class="posts-list">
                {% for article in all_articles %}
                    {% if article.category and article.category.name == "Typewriters" %}
                        {% if article.tags %}
                            {% set is_3d = false %}
                            {% for tag in article.tags %}
                                {% if tag.name == "3d-type-elements" %}
                                    {% set is_3d = true %}
                                {% endif %}
                            {% endfor %}
                            {% if is_3d %}
                            <article class="post-preview">
                                <h4><a href="{{ SITEURL }}/{{ article.url }}">{{ article.title }}</a></h4>
                                <div class="post-meta">
                                    <time datetime="{{ article.date.isoformat() }}">{{ article.locale_date }}</time>
                                    {% if article.tags %}
                                    <span class="tags">
                                        {% for tag in article.tags %}
                                        <a href="{{ SITEURL }}/{{ tag.url }}" class="tag">{{ tag.name }}</a>
                                        {% endfor %}
                                    </span>
                                    {% endif %}
                                </div>
                                {% if article.summary %}
                                <p class="post-summary">{{ article.summary }}</p>
                                {% endif %}
                                <a href="{{ SITEURL }}/{{ article.url }}" class="read-more">Read more →</a>
                            </article>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- General Typewriter Posts (not subcategorized) -->
        {% set has_general_posts = false %}
        {% for article in all_articles %}
            {% if article.category and article.category.name == "Typewriters" %}
                {% set is_general = true %}
                {% if article.tags %}
                    {% for tag in article.tags %}
                        {% if tag.name == "my-collection" or tag.name == "3d-type-elements" %}
                            {% set is_general = false %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
                {% if is_general %}
                    {% set has_general_posts = true %}
                {% endif %}
            {% endif %}
        {% endfor %}
        
        {% if has_general_posts %}
        <div class="posts-subsection">
            <h3>General Typewriter Posts</h3>
            <div class="posts-list">
                {% for article in all_articles %}
                    {% if article.category and article.category.name == "Typewriters" %}
                        {% set is_general = true %}
                        {% if article.tags %}
                            {% for tag in article.tags %}
                                {% if tag.name == "my-collection" or tag.name == "3d-type-elements" %}
                                    {% set is_general = false %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        {% if is_general %}
                        <article class="post-preview">
                            <h4><a href="{{ SITEURL }}/{{ article.url }}">{{ article.title }}</a></h4>
                            <div class="post-meta">
                                <time datetime="{{ article.date.isoformat() }}">{{ article.locale_date }}</time>
                                {% if article.tags %}
                                <span class="tags">
                                    {% for tag in article.tags %}
                                    <a href="{{ SITEURL }}/{{ tag.url }}" class="tag">{{ tag.name }}</a>
                                    {% endfor %}
                                </span>
                                {% endif %}
                            </div>
                            {% if article.summary %}
                            <p class="post-summary">{{ article.summary }}</p>
                            {% endif %}
                            <a href="{{ SITEURL }}/{{ article.url }}" class="read-more">Read more →</a>
                        </article>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        {% else %}
        <p>No typewriter blog posts yet. Check back soon!</p>
        {% endif %}
    </section>
    
</article>
{% endblock %}
